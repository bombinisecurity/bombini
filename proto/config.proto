syntax = "proto3";

package config;

// Configuration file for ProcMon detector
message ProcMonConfig {
    // setuid hook config.
    HookConfig setuid = 1;
    // capset hook config.
    HookConfig capset = 2;
    // prctl hook config.
    HookConfig prctl = 3;
    // create_user_ns hook config.
    HookConfig create_user_ns = 4;
    // ptrace_attach hook config.
    HookConfig ptrace_access_check = 5;
    // setgid hook config.
    HookConfig setgid = 6;
    // Collect IMA hashes for executed binaries.
    optional bool ima_hash = 8;
    // GC period for PROCMON_PROC_MAP default 30 sec.
    optional uint64 gc_period = 9;
}

// Configuration file for FileMon detector.
message FileMonConfig {
    // security_file_open config.
    HookConfig file_open = 1;
    // security_path_truncate config.
    HookConfig path_truncate = 2;
    // security_path_unlink config.
    HookConfig path_unlink = 3;
    // security_path_symlink config.
    HookConfig path_symlink = 4;
    // security_path_chmod config.
    HookConfig path_chmod = 5;
    // security_path_chown config.
    HookConfig path_chown = 6;
    // security_sb_mount config.
    HookConfig sb_mount = 7;
    // security_mmap_file config.
    HookConfig mmap_file = 8;
    // security_file_ioctl config.
    HookConfig file_ioctl = 9;
}

// Configuration file for NetMon detector.
message NetMonConfig {
    // Ingress traffic connections
    HookConfig ingress = 1;
    // Egress traffic connections
    HookConfig egress = 2;
}

// Configuration file for GTFOBinsDetector.
message GTFOBinsConfig {
    // Block execution of GTFOBins binaries.
    bool enforce = 1;
    // GTFOBins executables names.
    repeated string gtfobins = 2;
}

// Rule definition. Scope and event predicates are used as logical conjunction.
message Rule {
    // Name of the rule.
    string name = 1;
    // Logical predicate describes scope this rule will be applied, e.g. process, container.
    string scope = 2;
    // Logical predicate for describes event rule will be applied
    string event = 3;
}

// Hook or group of hooks configuration
message HookConfig {
    // Load eBPF programs
    bool enabled = 1;
    // Filtering rules
    repeated Rule rules = 2;
}